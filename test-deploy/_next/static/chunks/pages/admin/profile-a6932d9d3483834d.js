(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[172],{9660:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/profile",function(){return a(6198)}])},6198:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return j}});var s=a(5893),n=a(7294),r=a(1163),i=a(9478),l=a(1032),o=a(762),c=a(1919),d=a(6788),u=a(6541),h=a(4677),p=a(18),f=a(990),m=a(1574),x=a(6912),g=a(6493),w=a(7303),y=a(3454);function j(){let[e,t]=(0,n.useState)(null),[a,j]=(0,n.useState)(null),[Z,b]=(0,n.useState)(""),[v,_]=(0,n.useState)(""),[C,P]=(0,n.useState)(""),[N,S]=(0,n.useState)(""),[T,E]=(0,n.useState)(!1),[I,k]=(0,n.useState)(""),[U,A]=(0,n.useState)(""),B=(0,r.useRouter)();(0,n.useEffect)(()=>{let e=sessionStorage.getItem("accessToken");if(!e){B.push("/admin/login");return}t(e),L(e)},[B]);let L=async e=>{try{let t=await fetch("".concat(y.env.NEXT_PUBLIC_API_URL||"http://localhost:3001","/api/auth/me"),{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();j(e),S(e.display_name||"")}}catch(e){}},W=async t=>{t.preventDefault(),k(""),A(""),E(!0);try{let t=await fetch("".concat(y.env.NEXT_PUBLIC_API_URL||"http://localhost:3001","/api/auth/profile"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({display_name:N})}),a=await t.json();t.ok?(k("Profile updated successfully!"),j(e=>({...e,display_name:N})),setTimeout(()=>k(""),3e3)):A(a.error||"Failed to update profile")}catch(e){A("An error occurred while updating profile")}finally{E(!1)}},z=async t=>{if(t.preventDefault(),k(""),A(""),v.length<6){A("New password must be at least 6 characters");return}if(v!==C){A("New passwords do not match");return}E(!0);try{let t=await fetch("".concat(y.env.NEXT_PUBLIC_API_URL||"http://localhost:3001","/api/auth/change-password"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({currentPassword:Z,newPassword:v})}),a=await t.json();t.ok?(k("Password changed successfully!"),b(""),_(""),P(""),setTimeout(()=>k(""),3e3)):A(a.error||"Failed to change password")}catch(e){A("An error occurred while changing password")}finally{E(!1)}};return e&&a?(0,s.jsx)(i.Z,{title:"My Profile",backHref:"/admin",children:(0,s.jsxs)(l.Z,{maxWidth:"md",sx:{py:0},children:[I&&(0,s.jsx)(p.Z,{severity:"success",sx:{mb:3},children:I}),U&&(0,s.jsx)(p.Z,{severity:"error",sx:{mb:3},children:U}),(0,s.jsx)(o.Z,{elevation:3,sx:{mb:4},children:(0,s.jsxs)(c.Z,{children:[(0,s.jsxs)(d.Z,{variant:"h5",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1,mb:3},children:[(0,s.jsx)(g.Z,{color:"primary"}),"Profile Information"]}),(0,s.jsx)(f.Z,{component:"form",onSubmit:W,children:(0,s.jsxs)(m.Z,{spacing:3,children:[(0,s.jsx)(u.Z,{label:"Email",value:a.email,disabled:!0,fullWidth:!0,helperText:"Email cannot be changed"}),(0,s.jsx)(u.Z,{label:"Display Name",value:N,onChange:e=>S(e.target.value),fullWidth:!0,required:!0}),(0,s.jsx)(f.Z,{children:(0,s.jsx)(h.Z,{type:"submit",variant:"contained",disabled:T,size:"large",children:T?"Updating...":"Update Profile"})})]})})]})}),(0,s.jsx)(o.Z,{elevation:3,children:(0,s.jsxs)(c.Z,{children:[(0,s.jsxs)(d.Z,{variant:"h5",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1,mb:3},children:[(0,s.jsx)(w.Z,{color:"primary"}),"Change Password"]}),(0,s.jsx)(f.Z,{component:"form",onSubmit:z,children:(0,s.jsxs)(m.Z,{spacing:3,children:[(0,s.jsx)(u.Z,{label:"Current Password",type:"password",value:Z,onChange:e=>b(e.target.value),fullWidth:!0,required:!0,autoComplete:"current-password"}),(0,s.jsx)(x.Z,{}),(0,s.jsx)(u.Z,{label:"New Password",type:"password",value:v,onChange:e=>_(e.target.value),fullWidth:!0,required:!0,autoComplete:"new-password",helperText:"Minimum 6 characters"}),(0,s.jsx)(u.Z,{label:"Confirm New Password",type:"password",value:C,onChange:e=>P(e.target.value),fullWidth:!0,required:!0,autoComplete:"new-password"}),(0,s.jsx)(f.Z,{children:(0,s.jsx)(h.Z,{type:"submit",variant:"contained",color:"secondary",disabled:T,size:"large",children:T?"Changing...":"Change Password"})})]})})]})})]})}):(0,s.jsx)(f.Z,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,s.jsx)(d.Z,{children:"Loading..."})})}}},function(e){e.O(0,[737,736,592,888,179],function(){return e(e.s=9660)}),_N_E=e.O()}]);